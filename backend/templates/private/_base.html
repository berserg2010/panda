{% load static private_side_extras %}

<!DOCTYPE html>
<html lang="ru">
<head>

  <meta charset="utf-8">
  <meta name="description" content="">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!--<meta property="og:image" content="path/to/image.jpg">
    <link rel="shortcut icon" href="img/favicon/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="img/favicon/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="img/favicon/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="img/favicon/apple-touch-icon-114x114.png">-->

  <meta name="theme-color" content="#000">
  <meta name="msapplication-navbutton-color" content="#000">
  <meta name="apple-mobile-web-app-status-bar-style" content="#000">

  <title>{% block title %}{% endblock %}</title>

  <link rel="stylesheet" href="{% static 'css/main.min.css' %}">

  {% block style %}{% endblock %}

</head>
<body class="bodyLk">

<header class="header header-second">
  {% include 'private/components/header.html' %}
</header>

<section class="personalArea personalArea-active"> <!-- Левое меню скрыто (personalArea-active)-->

  {% include 'private/components/left_menu.html' %}

  {% block content %}{% endblock %}

</section>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://api.fondy.eu/static_common/v1/checkout/ipsp.js"></script>

{% block script %}{% endblock %}

<script src="{% static 'js/scripts.min.js' %}"></script>

{{ 'DEBUG'|get_settings_var|json_script:'DEBUG' }}
{{ 'MERCHANT_ID'|get_settings_var|json_script:'MERCHANT_ID' }}

<script>

  const DEBUG = JSON.parse(document.getElementById('DEBUG').textContent)
  const MERCHANT_ID = JSON.parse(document.getElementById('MERCHANT_ID').textContent)

  function createOrder(paid_for_lessons, amount, course_id) {

    const button = $ipsp.get('button')
    button.setMerchantId(MERCHANT_ID)
    button.setAmount(amount, 'RUB', !DEBUG)
    button.setResponseUrl(`${window.location.origin}/lk/payment-callback/`)
    button.setHost('api.fondy.eu')
    button.addField({
      label: 'Промо код',
      name: 'bonus_id'
    })
    button.addField({
      label: 'Количество занятий',
      name: 'paid_for_lessons',
      value: `${paid_for_lessons}`,
      readonly: true
    })
    button.addField({
      label: 'ID Ученика',
      name: 'student_id',
      value: `{{ user.student.pk }}`,
      readonly: true,
      hidden: true
    })
    button.addField({
      label: 'ID курса',
      name: 'course_id',
      value: `${course_id}`,
      readonly: true,
      hidden: true
    })
    window.open(button.getUrl())
    return false
  }

</script>

</body>
</html>
